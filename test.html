<!doctype html>
<html lang="th">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>เมนูวันนี้ จากวัตถุดิบที่มี</title>
	<style>
		:root{--accent:#f97316;--cream:#fff7ed;--brown:#7a4a2a;--muted:#7a4a2a;--border:#ecd8c6}
		*{box-sizing:border-box}
		body{font-family:system-ui,Arial,Helvetica,sans-serif;margin:0;color:var(--brown);background: #fffdf9}
		header{width:100%;background:var(--cream);border-bottom:1px solid var(--border);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
		.logo{font-weight:700;font-size:18px}
		.search{display:flex;gap:8px;align-items:center}
		.search input{padding:8px 10px;border:1px solid #ddd;border-radius:6px;width:320px}
		.search button{padding:8px 12px;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer}
		.layout{display:grid;grid-template-columns:300px 1fr;gap:16px;padding:16px}
		aside.panel{background:var(--cream);border:1px solid var(--border);padding:12px;border-radius:8px}
		main.panel{background:#fffaf6;border:1px solid var(--border);padding:12px;border-radius:8px}
		.ingredients-list{margin-top:8px;max-height:56vh;overflow:auto}
		.ingredients-list div{margin:6px 0}
		.filters{margin-top:12px;display:flex;flex-direction:column;gap:8px}
		select,input[type=text]{padding:8px;border:1px solid #ddd;border-radius:6px}
		.recipe-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
		.card{border:1px solid #eee;border-radius:8px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
		.card img{width:100%;height:140px;object-fit:cover}
		.card .body{padding:10px;display:flex;flex-direction:column;gap:8px}
		.labels{display:flex;gap:6px;flex-wrap:wrap}
		.label{background:var(--border);color:var(--brown);padding:4px 6px;border-radius:6px;font-size:12px}
		.recommended{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
		.muted{color:var(--muted);font-size:13px}
		.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;padding:16px}
		.modal .box{background:#fff;padding:14px;border-radius:8px;max-width:720px;width:100%;max-height:80vh;overflow:auto}
		@media(max-width:900px){.layout{grid-template-columns:1fr}.search input{width:180px}}
	</style>
</head>
<body>
	<header>
		<div class="logo">เมนูวันนี้ จากวัตถุดิบที่มี</div>
		<div class="search">
			<input id="searchInput" type="search" placeholder="พิมพ์ชื่อเมนูหรือวัตถุดิบ และกด Enter หรือค้นหา">
			<button id="searchBtn">ค้นหา</button>
		</div>
	</header>

	<div class="layout">
		<aside class="panel">
			<strong>วัตถุดิบ</strong>
			<div class="ingredients-list" id="ingredientsList"></div>

			<div style="display:flex;gap:8px;margin-top:10px">
				<input id="newIngredient" type="text" placeholder="เพิ่มวัตถุดิบอื่น ๆ">
				<button id="addIngBtn">+ เพิ่ม</button>
			</div>

			<div class="filters">
				<div><strong>ประเภทอาหาร</strong>
					<select id="filterType"><option value="">ทุกประเภท</option><option>ต้ม</option><option>ผัด</option><option>แกง</option><option>ทอด</option><option>ยำ</option><option>นึ่ง</option></select>
				</div>
				<div><strong>ข้อจำกัดอาหาร</strong>
					<select id="filterDiet"><option value="">ทุกประเภท</option><option>เจ</option><option>มังสวิรัติ</option><option>ฮาลาล</option><option>ไม่ใส่เนื้อ</option></select>
				</div>
				<div style="display:flex;gap:8px">
					<div style="flex:1"><strong>ระดับความยาก</strong><select id="filterDiff"><option value="">ทุกระดับ</option><option>ง่าย</option><option>กลาง</option><option>ยาก</option></select></div>
					<div style="flex:1"><strong>เวลา</strong><select id="filterTime"><option value="">ทุกเวลา</option><option>&lt;15</option><option>15–30</option><option>&gt;30</option></select></div>
				</div>
			</div>
		</aside>

		<main>
			<section class="panel" style="margin-bottom:12px">
				<div style="display:flex;justify-content:space-between;align-items:center">
					<strong>ผลลัพธ์สูตร</strong>
					<span id="resultsCount" class="muted"></span>
				</div>
				<div id="recipes" class="recipe-grid" style="margin-top:12px"></div>
				<div id="recommended" class="recommended"></div>
			</section>
		</main>
	</div>

	<div id="modalRoot" style="display:none"></div>

	<script>
		// ตัวอย่างสูตร (มี recipe_url สำหรับรองรับอนาคต)
		const RECIPES = [
			{id:1,name:'ผัดกระเพราไก่',image:'https://source.unsplash.com/400x300/?stirfry',labels:['เผ็ด'],ingredients:['ไก่','กระเพรา','พริก'],type:'ผัด',diet:'ไม่ใส่เนื้อ',difficulty:'ง่าย',time:'15–30',popularity:8,recipe_url:''},
			{id:2,name:'ต้มยำกุ้ง',image:'https://source.unsplash.com/400x300/?soup',labels:['เผ็ด'],ingredients:['กุ้ง','ตะไคร้','มะนาว'],type:'ต้ม',diet:'ไม่ใส่เนื้อ',difficulty:'กลาง',time:'15–30',popularity:10,recipe_url:''},
			{id:3,name:'แกงเขียวหวานเจ',image:'https://source.unsplash.com/400x300/?curry',labels:['เจ'],ingredients:['มะเขือ','มะเขือเทศ','กะทิ'],type:'แกง',diet:'เจ',difficulty:'กลาง',time:'>30',popularity:6,recipe_url:''},
			{id:4,name:'สลัดผักรวม',image:'https://source.unsplash.com/400x300/?salad',labels:['ง่าย'],ingredients:['ผัก','มะเขือเทศ','น้ำสลัด'],type:'ยำ',diet:'มังสวิรัติ',difficulty:'ง่าย',time:'<15',popularity:7,recipe_url:''},
			{id:5,name:'ปลาทอดกระเทียม',image:'https://source.unsplash.com/400x300/?fried',labels:['ไม่ใส่เนื้อ'],ingredients:['ปลา','กระเทียม','น้ำปลา'],type:'ทอด',diet:'ไม่ใส่เนื้อ',difficulty:'กลาง',time:'15–30',popularity:5,recipe_url:''}
		];

		// วัตถุดิบเริ่มต้นตามที่ระบุ
		const START_ING = ['หมู','ไก่','ไข่','เห็ด','ผัก','ข้าว','เต้าหู้','กุ้ง','ปลา'];

		const state = { ingredients: new Set(START_ING), selected: new Set(), nameQuery: '', filters:{type:'',diet:'',difficulty:'',time:''} };

		const ingredientsListEl = document.getElementById('ingredientsList');
		const recipesEl = document.getElementById('recipes');
		const recommendedEl = document.getElementById('recommended');
		const resultsCountEl = document.getElementById('resultsCount');

		function renderIngredients(){
			ingredientsListEl.innerHTML = '';
			Array.from(state.ingredients).sort().forEach(ing=>{
				const id = 'ing_'+ing.replace(/\s+/g,'_');
				const wr = document.createElement('div');
				wr.innerHTML = `<label><input type="checkbox" id="${id}" ${state.selected.has(ing)?'checked':''}/> ${ing}</label>`;
				ingredientsListEl.appendChild(wr);
				wr.querySelector('input').addEventListener('change', e=>{
					if(e.target.checked) state.selected.add(ing); else state.selected.delete(ing);
					applyFilters();
				});
			});
		}

		function addIngredient(name, select=true){
			if(!name) return;
			const t = name.trim(); if(!t) return;
			// หากไม่มี ให้เพิ่ม
			const exists = Array.from(state.ingredients).some(i=>i.toLowerCase()===t.toLowerCase());
			if(!exists) state.ingredients.add(t);
			if(select) {
				// find original-cased value
				const real = Array.from(state.ingredients).find(i=>i.toLowerCase()===t.toLowerCase());
				state.selected.add(real);
			}
			renderIngredients();
			applyFilters();
		}

		// ค้นหา: กดปุ่มหรือ Enter ในช่อง search
		function doSearch(){
			const v = document.getElementById('searchInput').value.trim();
			if(!v) return;
			state.nameQuery = v;
			// ถ้าเป็นชื่อวัตถุดิบใหม่ -> เพิ่มและเลือก
			const match = Array.from(state.ingredients).find(i=>i.toLowerCase()===v.toLowerCase());
			if(!match){ addIngredient(v, true); }
			else{ state.selected.add(match); renderIngredients(); applyFilters(); }
			document.getElementById('searchInput').value = '';
		}

		document.getElementById('searchBtn').addEventListener('click', doSearch);
		document.getElementById('searchInput').addEventListener('keydown', e=>{ if(e.key==='Enter'){ doSearch(); }});

		document.getElementById('addIngBtn').addEventListener('click', ()=>{ addIngredient(document.getElementById('newIngredient').value); document.getElementById('newIngredient').value=''; });
		document.getElementById('newIngredient').addEventListener('keydown', e=>{ if(e.key==='Enter'){ addIngredient(e.target.value); e.target.value=''; }});

		['filterType','filterDiet','filterDiff','filterTime'].forEach(id=>{
			document.getElementById(id).addEventListener('change', e=>{ const key = id.replace('filter','').toLowerCase(); state.filters[key]=e.target.value; applyFilters(); });
		});

		function matches(r){
			const f = state.filters;
			if(f.type && r.type !== f.type) return false;
			if(f.diet && r.diet !== f.diet) return false;
			if(f.difficulty && r.difficulty !== f.difficulty) return false;
			if(f.time && r.time !== f.time) return false;
			if(state.nameQuery){ const q = state.nameQuery.toLowerCase(); if(!r.name.toLowerCase().includes(q) && !r.ingredients.some(i=>i.toLowerCase().includes(q))) return false; }
			for(const sel of state.selected){ if(!r.ingredients.map(i=>i.toLowerCase()).includes(sel.toLowerCase())) return false; }
			return true;
		}

		function applyFilters(){
			const results = RECIPES.filter(matches);
			renderRecipes(results);
			renderRecommended(results);
		}

		function renderRecipes(list){
			recipesEl.innerHTML = '';
			resultsCountEl.textContent = `${list.length} รายการ`;
			if(list.length===0){ recipesEl.innerHTML = '<div class="muted">ไม่พบสูตรที่ตรงกับเงื่อนไข</div>'; return; }
			list.forEach(r=>{
				const el = document.createElement('div'); el.className='card';
				el.innerHTML = `<img src="${r.image}" alt="${r.name}"><div class="body"><div style="display:flex;justify-content:space-between;align-items:flex-start"><div><strong>${r.name}</strong><div class="muted" style="font-size:12px">${r.type} · ${r.time}</div></div><button data-id="${r.id}">ดูสูตร</button></div><div class="labels">${r.labels.map(l=>`<span class="label">${l}</span>`).join('')}</div></div>`;
				recipesEl.appendChild(el);
				el.querySelector('button').addEventListener('click', ()=>openRecipe(r));
			});
		}

		function renderRecommended(currentResults){
			const pool = currentResults.length? currentResults : RECIPES;
			const sorted = pool.slice().sort((a,b)=>b.popularity - a.popularity).slice(0,6);
			recommendedEl.innerHTML = '';
			sorted.slice(0,6).forEach(r=>{
				const c = document.createElement('div'); c.className='card'; c.style.flex='1 1 140px'; c.style.minWidth='140px';
				c.innerHTML = `<img src="${r.image}"><div class="body"><strong>${r.name}</strong><div class="muted" style="font-size:12px">${r.type} · ${r.time}</div></div>`;
				recommendedEl.appendChild(c);
			});
		}

		function openRecipe(r){
			const root = document.getElementById('modalRoot'); root.style.display='block'; root.innerHTML='';
			const modal = document.createElement('div'); modal.className='modal';
			modal.innerHTML = `<div class="box"><button id="closeModal" style="float:right">ปิด</button><h3>${r.name}</h3><img src="${r.image}" style="width:100%;max-height:220px;object-fit:cover;border-radius:6px;margin-bottom:8px"><p><strong>ประเภท:</strong> ${r.type} · <strong>เวลา:</strong> ${r.time} · <strong>ข้อจำกัด:</strong> ${r.diet} · <strong>ความยาก:</strong> ${r.difficulty}</p><p><strong>วัตถุดิบ:</strong> ${r.ingredients.join(', ')}</p><p><em>${r.recipe_url?'<a href="'+r.recipe_url+'" target="_blank">ดูสูตรที่มา</a>':'สูตรอาหารจะเพิ่มในภายหลัง'}</em></p></div>`;
			root.appendChild(modal);
			modal.querySelector('#closeModal').addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; });
		}

		// init
		renderIngredients();
		applyFilters();
	</script>
</body>
</html>

